<html>

<head>
<meta name="GENERATOR" content="Microsoft FrontPage 5.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<title>CS536 Programming Assignment 2</title>
<link rel="stylesheet" type="text/css" href="../../webpage.css">
<style>
<!--
h1, h2, h3 { margin-top:0; margin-bottom:-10 }
table.page   { align: center; width: 100%; border: no }
p.navigation { font-size: 70%; color: #006600 }
p.sectionDesc { font-size: 90%; font-weight: bold; color: #000080 }
.subtitle { font-size: 70%; font-weight: normal; color: #006600 }
.reg { font-size: 90% }
.headerBG { background-color: #cde7f0 }
.standoutBG { background-color: #e0f8ec }
.regBG { background-color: #ffffff }
.bottomStyle { font-size: 70%; color: #FFFFFF}
-->
</style>
<? 
	$ourlang = "CFlat";
	$dueDate = date_parse("2 October 2014"); 
	function print_duedate(){
		print($dueDate['month'] . "/" . $dueDate['day']);
	}
?>

</head>

<body>

<table class="page" cellpadding="8" cellspacing="0">

	<span class=byline>Due by 11:59 PM on 
		<?
			$dueDate = $assignments['p2']['due'];
			print($dueDate['month'] . "/" . $dueDate['day'])?>
	</span>

	<? printLateDayTable("p2"); ?>
For more info on the late day policy, see the 
<a href=assignments.php>assignments</a> page.

</td></tr>

<tr><td></td></tr> <!-- space between items -->

<tr><td class="regBG">
<h2 id="Overview">Overview</h2>
<p class="reg">For this assignment you will use JLex to write a scanner
for our language, called <?print("$ourlang")?>, a small subset of the C++ language.
Features of <tt><?print("$ourlang")?></tt> that are relevant to this assignment
are described below.
You will also write a main program (<tt>P2.java</tt>)  to test your scanner.
You will be graded both on the correctness of your scanner
and on how thoroughly your main program tests the scanner.
</p>
</td></tr>

<tr><td></td></tr> <!-- space between items -->

<tr><td class="regBG">
<h2 id="Specifications">Specifications</h2>

<ul class="reg">
  <li><a href="#starting">Getting started</a></li>
  <li><a href="#jlex">JLex</a></li>
  <li><a href="#our_language">The <tt>CFlat</tt> Language</a></li>
  <li><a href="#scanner_actions">What the Scanner Should Do</a></li>
  <li><a href="#errors">Errors and Warnings</a></li>
  <li><a href="#main">The Main Program</a></li>
  <li><a href="#testing">Testing</a></li>
  <li><a href="#pairs">Working in Pairs</a></li>
</ul>

<h3 id="starting">Getting Started</h3>
<p class="reg">
Skeleton files on which you should build are in:
<tt>~cs536-1/public/html/assignments/p2/files</tt>
</p>
<p class="reg">
The files are:
</p>
<ul class="reg">
  <li><a href="assignments/p2/files/CFlat.jlex"><tt>CFlat.jlex</tt></a>:
       An example JLex specification.
  <em>You will need to add to this file.</em>
  <li><a href="assignments/p2/files/sym.java"><tt>sym.java</tt></a>:
       Token definitions (this file will eventually be
       generated by the parser generator). Do not change this file.</li>
  <li><a href="assignments/p2/files/ErrMsg.java"><tt>ErrMsg.java</tt></a>:
       The <tt>ErrMsg</tt> class will be used to print error and warning messages. Do not change this file.</li>
  <li><a href="assignments/p2/files/P2.java"><tt>P2.java</tt></a>:
       Contains the main program that tests the scanner. <em>You will need to add to this file.</em></li>
  <li><a href="assignments/p2/files/Makefile"><tt>Makefile</tt></a>: A Makefile that
       uses JLex to create a scanner, and also makes <tt>P2.class</tt>. <em>You may want to change this file.</em></li>
</ul>


<h3 id="jlex">JLex</h3>
<p class="reg">
Use the on-line <a href="http://www.cs.princeton.edu/~appel/modern/java/JLex/current/manual.html">JLex reference manual</a>, 
and/or the on-line <a href="reading.php?r=jlex">JLex notes</a> for 
information about writing a JLex specification.
</p>
<p class="reg">
If you work on a CS Dept. Linux machine, you should have no problem running JLex. You will not be able to work on the CS Dept. Windows machines. 
<!--
Here are 
<a href="jarFiles.html">instructions</a> to follow if you want to work on another machine. 
-->

<h3 id="our_language">The <tt><?print($ourlang)?></tt> Language</h3>
<p class="reg">
This section defines the lexical level of the <tt>CFlat</tt> language.
At this level, we have the following language issues:
</p>
<dl class="reg">
<dt><h4>Tokens</h4></dt>
<dd>

The tokens of the <tt>CFlat</tt> language are defined as follows:
<ul>
  <li>Any of the following reserved words (remember that you will need to give the JLex patterns for reserved words <i>before</i> the pattern for identifier):
<dir><pre>
bool  int   void  true  false  struct
cin   cout  if    else  while  return  
</pre></dir>
</li>
  <li>Any identifier (a sequence of one or more letters and/or digits,
       and/or underscores, starting with a letter or underscore, excluding
       reserved words).</li>
  <li>Any integer literal (a sequence of one or more digits).</li>
  <li id="strLit">Any string literal (a sequence of zero or more <i>string</i> characters
       surrounded by double quotes). A <i>string</i> character is either 
       <ul>
       <li>an escaped character: a backslash followed by any one of the following six characters:
         <ol>
		<li><tt>n</tt></li>
        <li><tt>t</tt></li>
        <li>a single quote</li>
        <li>a double quote</li>
        <li>a question mark</li>
        <li>another backslash</li>
       </ol>
       or 
       </li>
       <li>a single character other than newline or double quote or backslash.</li>
       </ul>
       Examples of legal string literals:
<dir><pre>""
"&amp;!88"
"use \n to denote a newline character"
"include a quote like this \" and a backslash like this \\"
</pre></dir>
       Examples of things that are <b><em>not</em></b> legal string literals:
<dir><pre>"unterminated
"also unterminated \"
"backslash followed by space: \ is not allowed"
"bad escaped character: \a AND not terminated
</pre></dir>
</li>
  <li>Any of the following one- or two-character symbols:
<dir>
<pre>
{      }      (      )      ;      
,      .      &lt;&lt;     &gt;&gt;     ++
--     +      -      *      /
!      &amp;&amp;     ||     ==     !=
&lt;      &gt;      &lt;=     &gt;=     =
</pre></dir>
</li>
</ul>
<p>
Token &quot;names&quot; (i.e., values to be returned by the scanner)
are defined in the file
<tt><a href="assignments/p2/files/sym.java">sym.java</a></tt>.
For example, the name for the token to be returned when an integer
literal is recognized is <tt>INTLITERAL</tt> and the token to be
returned when the reserved word <tt>int</tt> is recognized is
<tt>INT</tt>.</p>
<p>
Note that code telling JLex to return the special <tt>EOF</tt> token on end-of-file
has already been included in the file <tt>CFlat.jlex</tt> -- you don't have to 
include a specification for that token. Note also that the <tt>READ</tt> token is for the 
2-character symbol <tt>&gt;&gt;</tt> and the <tt>WRITE</tt> token is for the 2-character symbol 
<tt>&lt;&lt;</tt>
</p>
<p>If you are not sure which token name matches which token, ask!</p>
</dd>

<dt><h4>Comments</h4></dt>
<dd>
Text starting with a double slash (<tt>//</tt>) or a sharp sign (<tt>#</tt>) up to the end
of the line is a comment (except of course if those characters are inside
a string literal).
For example:
<dir><pre>// this is a comment
# and so is this
</pre></dir>
<p>
The scanner should recognize and ignore comments (but there is no
<tt>COMMENT</tt> token).
</p>
</dd>

<dt><h4>Whitespace</h4></dt>
<dd>
Spaces, tabs, and newline characters are whitespace.
Whitespace separates tokens and changes the character counter, 
but should otherwise be ignored (except inside
a string literal).
</dd>

<dt><h4>Illegal Characters</h4></dt>
<dd>
Any character that is not whitespace and is not part of a token or
comment is illegal.
</dd>

<dt><h4>Length Limits</h4></dt>
<dd>
You may not assume any limits on the lengths of identifiers, string literals,
integer literals, comments, etc.
</dd>
</dl>

<h3 id="scanner_actions">What the Scanner Should Do</h3>
<p class="reg">
The main job of the scanner is to identify and return the next token.
The value to be returned includes:
</p>
<ul class="reg">
  <li>The token &quot;name&quot; (e.g., <tt>INTLITERAL</tt>).
       Token names are defined in the file
       <a href="assignments/p2/files/sym.java"><tt>sym.java</tt></a>.</li>
  <li>The line number in the input file on which the token starts.</li>
  <li>The number of the character on that line at which the token starts.</li>
  <li>For identifiers, integer literals, and string literals: the actual
       value (a <tt>String</tt>, an <tt>int</tt>, or a <tt>String</tt>,
       respectively).
       For a string literal, the value should include the double quotes
       that surround the string,
       as well as any backslashes used inside the string as part of an
       &quot;escaped&quot; character.</li>
</ul>

<p class="reg">
Your scanner will return this information by creating a new <tt>Symbol</tt>
object in the action associated with each regular expression that defines
a token (the <tt>Symbol</tt> type is defined in <tt>java_cup.runtime</tt>;
you don't need to look at that definition).
A <tt>Symbol</tt> includes a field
of type <tt>int</tt> for the token name, and a field of type
<tt>Object</tt> (named <tt>value</tt>), which will be used for the line
and character numbers and for the token value (for identifiers and
literals).
See <a href="assignments/p2/files/CFlat.jlex"><tt>CFlat.jlex</tt></a> for examples of
how to call the <tt>Symbol</tt> constructor.
See <a href="assignments/p2/files/P2.java"><tt>P2.java</tt></a> for code that accesses
the fields of a <tt>Symbol</tt>.
</p>
<p class="reg">
In your compiler, the <tt>value</tt> field of a <tt>Symbol</tt> will actually
be of type <tt>TokenVal</tt>;
that type is defined in
<a href="assignments/p2/files/CFlat.jlex"><tt>CFlat.jlex</tt></a>.
Every <tt>TokenVal</tt> includes a <tt>linenum</tt> field, and a
<tt>charnum</tt> field (line and character numbers start counting from 1, not 0).
Subtypes of <tt>TokenVal</tt> with more fields will be used for
the values associated with identifier, integer literal, and string literal
tokens. These subtypes, <tt>IntLitTokenVal</tt>,
<tt>IdLitTokenVal</tt>,  and <tt>StrLitTokenVal</tt> are also defined in
<A HREF="assignments/p2/files/CFlat.jlex"><tt>CFlat.jlex</tt></a>.
</p>
<p class="reg">
Line counting is done by the scanner generated by
JLex (the variable <tt>yyline</tt> holds the current line number, counting
from 0), but you will have to include
code to keep track of the current character number on that line.
The code in <a href="assignments/p2/files/CFlat.jlex"><tt>CFlat.jlex</tt></a> does this
for the patterns that it defines, and you should be able to figure out
how to do the same thing for the new patterns that you add.
</p>
<p class="reg">
The JLex scanner also provides a method <tt>yytext</tt> that returns
the actual text that matches a regular expression.
You will find it useful to use this method in the actions you write
in your JLex specification.
</p>
<p class="reg">
Note that, for the integer literal token, you will need to convert
a <tt>String</tt> (the value scanned) to an <tt>int</tt> (the
value to be returned).
You should use code like the following:
</p>
<dir><pre>double d = (new Double(yytext())).doubleValue(); // convert String to double
// INSERT CODE HERE TO CHECK FOR BAD VALUE -- SEE ERRORS AND WARNINGS BELOW
int k =  (new Integer(yytext())).intValue();    // convert to int
</pre></dir>

<h3 id="errors">Errors and Warnings</h3>
<p class="reg">
The scanner should handle the following errors as indicated:
</p>
<dl class="reg">
<dt><h4><i>Illegal characters</i></h4></dt>
<dd> Issue the error message:
     <tt>illegal character ignored: ch</tt> (where <tt>ch</tt> is the
     illegal character) and ignore the character.
</dd>

<dt><h4><i>Unterminated string literals</i></h4></dt>
<dd> A string literal is considered to be unterminated if there is a
     newline or end-of-file before the closing quote.
     Issue the error message: <tt>unterminated string literal ignored</tt>
     and ignore the unterminated string literal (start looking for the
     next token after the newline).
</dd>

<dt><h4><i>Bad string literals</i></h4></dt>
<dd> A string literal is &quot;bad&quot; if it includes a bad &quot;escaped&quot; character;
     i.e., a backslash followed by something other than an <tt>n</tt>, a
     <tt>t</tt>, a single quote, a double quote, or another backslash.
     Issue the error message:
     <tt>string literal with bad escaped character ignored</tt>
     and ignore the string literal (start looking for the
     next token after the closing quote).
     If the string literal has a bad escaped character <em>and</em> is
     unterminated, issue the error message
     <tt>unterminated string literal with bad escaped character ignored</tt>,
     and ignore the bad string literal (start looking for the next token
     after the newline).
     Note that a string literal that has a newline immediately after a
     backslash should be treated as having a bad escaped character and
     being unterminated.  For example, given:
     <br><ul class="reg"><tt>
     "very bad string \
     <br>abc
     </tt></ul>
     the scanner should report an unterminated string literal with a bad
     escaped character on line 1, and an identifier on line 2.
</dd>
 
<dt><h4> <i>Bad integer literals</i> (integer literals larger than
     <tt>Integer.MAX_VALUE</tt>)</h4></dt>
<dd> Issue the warning message:
     <tt>integer literal too large; using max value</tt>
     and return <tt>Integer.MAX_VALUE</tt> as the value for that token.
</dd>
</dl>
<p class="reg">
For unterminated string literals, bad string literals, and bad integer
literals, the line and column numbers used in the error message
should correspond to the position of the <em>first</em> character
in the string/integer literal.
</p>
<p class="reg">
Use the <tt>fatal</tt> and <tt>warn</tt> methods of the <tt>ErrMsg</tt> class
to print error and warning messages.
Be sure to use <em>exactly</em> the wording given above for each message
so that the output of your scanner will match the output that we expect
when we test your code.
</p>

<h3 id="main">The Main Program</h3>
<p class="reg">
In addition to specifying a scanner, you should extend the main
program in <a href="assignments/p2/files/P2.java"><tt>P2.java</tt></a>.
The program opens a file called <tt>allTokens.in</tt> for reading;
then the program loops, calling the scanner's <tt>next_token</tt> method
until the special end-of-file token is returned.
For each token, it writes the corresponding lexeme to a file called
<tt>allTokens.out</tt>.
You can use <tt>diff</tt> to compare the input and output files
(<tt>diff allTokens.in allTokens.out</tt>).
If they differ, you've found an error in the scanner.
Note that you will need to write the <tt>allTokens.in</tt> file.
</p>

<h3 id="testing">Testing</h3>
<p class="reg">
Part of your task will be to figure out a strategy for testing
your implementation.
As mentioned in the <a href="#Overview">Overview</a>, part of your
grade will be determined by how thoroughly your main program tests your scanner.
</p>

<p class="reg">
You will probably want to change <tt>P2.java</tt> to read multiple
input files so that you can test other features of the scanner.
You will need to create a new scanner each time and you will need to set
<tt>CharNum.num</tt> back to one each time (to get correct character numbers
for the first line of input).
Note that the input files do <em>not</em> have to be legal <tt>CFlat</tt>
or C++ programs,
just sequences of characters that correspond to <tt>CFlat</tt> tokens.

  <b>Don't forget to include code that tests whether the correct
    character number (as well as line number) is returned for every token!</b> </p>
<p class="reg">Your <tt>P2.java</tt> should exercise all
of the code in your scanner, including the code that reports errors.

Add to the provided <a href="assignments/p2/files/Makefile"><tt>Makefile</tt></a> (as necessary) so that running <tt>make test</tt> runs your <tt>P2</tt> and does any needed file comparisons (e.g., using <tt>diff</tt>) and running <tt>make cleantest</tt> removes any files that got created by your program when <tt>P2</tt> was run. It should be clear from what is printed to the console when <tt>make test</tt> is run what errors have been found.
</p>



<p class="reg">
To test that your scanner correctly handles an unterminated string literal
with end-of-file before the closing quote, 
you may use the file
<a href="assignments/p2/files/eof.txt"><tt>~cs536-1/public/prog2/eof.txt</tt></a>.
On a Linux machine, you can tell that there is no final newline by
typing: <tt>cat eof.txt</tt>
You should see your command-line prompt at the <em>end</em> of the
last line of the output instead of at the beginning of the following
line.
</p>

<h3 id="pairs">Working in Pairs</h3>
<p class="reg">Computer Sciences and Computer Engineering graduate students must work alone on this assignment.
Undergraduates, special students, and graduate students from other departments may work alone or in pairs.
</p>
<p class="reg">If you plan to work with a partner, you must let us know <b><em>no later than February 22</em></b>. 
To let us know, each partner should handin a <a href="assignments/README.txt"><tt>README.txt</tt></a> file 
filled in with the name and CS login of <em>both</em> partners. </p>
<p class="reg">If you want to work with a partner, but don't have one, check
out the <a href="https://piazza.com/class/hxhndf8ppo228c?cid=5">&quot;Search for Teammates!&quot;</a> 
  note in Piazza.</p>
<p class="reg">If you are working with a partner and you decide to split up, you must let Beck Hasti know by email so that we can arrange how to divide up any code that has already been written.</p>
<p class="reg">
Below is some advice on how to work in pairs.
</p>
<p class="reg">
This assignment involves two main tasks:
</p>
<ol class="reg">
  <li>Writing the scanner specification (<tt>CFlat.jlex</tt>).</li>
  <li>Writing the main program (<tt>P2.java</tt>).</li>
</ol>
<p class="reg">
An excellent way to work together is to do <i>pair programming</i>:
Meet frequently and work closely together on both tasks.
Sit down together in front of a computer.
Take turns "driving" (controlling the keyboard and mouse)
and "verifying" (watching what the driver does and spotting mistakes).
Work together on all aspects of the project: design, coding, debugging,
and testing.
Often the main advantage of having a partner is not having somebody to
write half the code, but having somebody to bounce ideas off of and
to help spot your mistakes.
</p>
<p class="reg">
If you decide to divide up the work, you are <em>strongly</em> encouraged
to work together on task (1) since both partners are responsible for
learning how to use JLex.
You should also work together on testing;
in particular, you should each test the other's work.
</p>
<p class="reg">
Here is one reasonable way to divide up the project:
</p>
<ul class="reg">
  <li>Divide up the tokens into two parts, one part for each person.</li>
  <li>Each person  extends their own copy of <tt>CFlat.jlex</tt>
       by adding rules for their half of the tokens, and  extends
       their own copy of the main program to handle those same tokens.</li>
  <li>Decide together how your <tt>P2.java</tt> should work, and write
       that code.</li>
  <li>Write test input files for your own tokens, and  for the other
       person's tokens, too.</li>
  <li>After each person makes sure that their scanner and main program
       work on their own tokens, combine the two (it should be pretty easy
       to cut and paste one person's JLex rules into the other person's
       <tt>CFlat.jlex</tt>, and similarly for the main program).</li>
  <li>Do <em>not</em> try to implement all of your half of the tokens
       at once.  Instead, implement just a few to start with to make
       sure that you both know what you're doing and that you're able
       to combine your work easily.</li>
</ul>

<p class="reg">
The most challenging JLex rules are for the
<tt>STRINGLITERAL</tt> token (for which you will need several rules: for a
correct string literal, for an unterminated string literal, for
a string literal that contains a bad escaped character, and for a
string literal that contains a bad escaped character <em>and</em>
is unterminated).
Be sure to divide these up so that each person gets to work on some of them.
</p>
<p class="reg">
It is <b>very</b> important to set deadlines and to stick to them.
I suggest that you choose one person to be the &quot;project leader&quot; (plan
to switch off on future assignments).
The project leader should propose a division of tokens, as well as deadlines
for completing phases of the program, and should be responsible for
keeping the most recent version of the combined code (be sure to keep
back-up versions, too, perhaps in another directory or using
a version-control system like Mercurial or Git).
</p>
<p class="reg">
To share your code, you can either use e-mail or the project leader
can create a directory for the combined code (<em>not</em> the directory
in which that person develops the code).
I suggest that you create a new top-level directory (i.e., at the same
level as your <tt>public</tt> and <tt>private</tt> directories), named
something like <tt>cs536-P2</tt>.
To set the permissions of the directory for the combined code to allow your
partner to write into it, change to that directory and type:
</p>
<dir><pre>fs setacl . &lt;login&gt; write</pre></dir>
<p class="reg">
using your partner's CS login in place of <tt>&lt;login&gt;</tt>.
You should also prevent any other access by typing:
</p>
<dir><pre>fs setacl . system:anyuser none</pre></dir>
<p class="reg">
in the new directory that you create (<em>not</em> in your top-level
directory).
To see what the permissions are in your current directory, type:
</p>
<dir><pre>fs listacl</pre></dir>
<p class="reg">
Do <em>not</em> try to share by letting your partner log in to your account.
Departmental and University policy prohibits your revealing your password
to anybody else, including your partner.
</p>
</td>
</tr>

<tr><td></td></tr> <!-- space between items -->

<tr><td class="regBG">
<h2 id="Handin">Handing in</h2>
<? printProgramHandin("p2") ?>

<tr><td class="regBG">
<h2 id="Grading">Grading criteria</h2>
<p class="reg">
General information on program
grading criteria can be found
on the <a href="assignments.html">Assignments</a> page).
</p>
<p class="reg">
For more advice on Java programming style, see
<a href="http://www.oracle.com/technetwork/java/javase/documentation/codeconvtoc-136057.html">
Code Conventions for the Java Programming Language.</a>
See also the
    <a href="http://www.cs.wisc.edu/~cs302/resources/guides/style.html">style</a> and
    <a href="http://www.cs.wisc.edu/~cs302/resources/guides/commenting.html">commenting</a>
    standards used in CS 302 and CS 367.
</p>
</td></tr>
</table>
</body>

</html>
